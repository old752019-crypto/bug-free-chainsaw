<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶¨‡¶æ‡¶ö‡ßç‡¶ö‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ - ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Hind Siliguri', sans-serif;
        }

        body {
            background: linear-gradient(145deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 15px;
            animation: gradientBG 15s ease infinite;
            background-size: 400% 400%;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 40px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        .child-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .avatar {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            border: 4px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .child-name {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .child-status {
            display: inline-block;
            padding: 8px 20px;
            background: rgba(16, 185, 129, 0.3);
            border: 1px solid #10B981;
            border-radius: 50px;
            color: white;
            font-size: 14px;
            margin-top: 10px;
        }

        /* ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 50px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10B981;
            box-shadow: 0 0 10px #10B981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        .status-text {
            color: white;
            font-size: 14px;
        }

        .device-id {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 50px;
        }

        /* ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: white;
            font-size: 20px;
            font-weight: 600;
        }

        .permission-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .permission-card {
            background: rgba(255, 255, 255, 0.07);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .permission-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .permission-icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .permission-details h4 {
            color: white;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .permission-details p {
            color: rgba(255,255,255,0.6);
            font-size: 12px;
        }

        .permission-status {
            padding: 6px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-granted {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-denied {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .permission-btn {
            background: linear-gradient(135deg, #667EEA, #764BA2);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .permission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px #667EEA80;
        }

        .permission-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠‡¶æ‡¶∞ */
        .command-receiver {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 15px;
            margin-top: 20px;
        }

        .command-title {
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .command-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .command-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            color: white;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .command-execute {
            background: #10B981;
            border: none;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
        }

        /* ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶≠‡¶ø‡¶â */
        .camera-section {
            margin-top: 20px;
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            display: none;
        }

        #childCameraFeed {
            width: 100%;
            aspect-ratio: 9/16;
            object-fit: cover;
        }

        /* ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="child-header">
            <div class="avatar">üë∂</div>
            <div class="child-name">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏</div>
            <div class="connection-status">
                <div class="status-dot"></div>
                <span class="status-text">‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°</span>
            </div>
            <div class="device-id" id="deviceId">‡¶Ü‡¶á‡¶°‡¶ø: ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>

        <!-- ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div class="section">
            <div class="section-title">
                <span>üîê</span> ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶®
            </div>
            
            <div class="permission-grid" id="permissionGrid"></div>
        </div>

        <!-- ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠‡¶æ‡¶∞ -->
        <div class="section">
            <div class="section-title">
                <span>üì®</span> ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°
            </div>
            
            <div class="command-receiver">
                <div class="command-title">
                    <span>‚è≥</span> ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶£ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°
                </div>
                <div class="command-list" id="commandList">
                    <div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">
                        ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶®‡ßá‡¶á
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶≠‡¶ø‡¶â -->
        <div class="camera-section" id="cameraSection">
            <video id="childCameraFeed" autoplay playsinline></video>
        </div>
    </div>

    <!-- ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® -->
    <div class="notification" id="notification">
        <span id="notificationIcon">‚ÑπÔ∏è</span>
        <span id="notificationMessage"></span>
    </div>

    <script>
        // ==================== ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ====================
        const firebaseConfig = {
  apiKey: "AIzaSyCqQWN12_BLgqIc-d6cXcNSmJbHW6lOAOk",
  authDomain: "baflix-dc336.firebaseapp.com",
  databaseURL: "https://baflix-dc336-default-rtdb.firebaseio.com",
  projectId: "baflix-dc336",
  storageBucket: "baflix-dc336.firebasestorage.app",
  messagingSenderId: "205531061557",
  appId: "1:205531061557:web:9571d3ae27e8c27399007c",
  measurementId: "G-KQYMD6CQYQ"
};

        // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // ==================== ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ====================
        let deviceId = generateDeviceId();
        let permissions = {
            camera: false,
            location: false,
            microphone: false,
            storage: false
        };
        let currentStream = null;

        // ==================== ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ====================
        function generateDeviceId() {
            let saved = localStorage.getItem('device_id');
            if (saved) return saved;
            
            let newId = 'DEVICE_' + Math.random().toString(36).substr(2, 9).toUpperCase();
            localStorage.setItem('device_id', newId);
            return newId;
        }

        // ==================== ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏‡ßá ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ====================
        function registerDevice() {
            document.getElementById('deviceId').textContent = '‡¶Ü‡¶á‡¶°‡¶ø: ' + deviceId;
            
            // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶§‡¶•‡ßç‡¶Ø ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠
            database.ref('devices/' + deviceId).set({
                deviceId: deviceId,
                deviceName: navigator.userAgent,
                lastSeen: firebase.database.ServerValue.TIMESTAMP,
                status: 'online',
                permissions: permissions,
                battery: 'unknown'
            });
            
            // ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
            database.ref('devices/' + deviceId).onDisconnect().update({
                status: 'offline',
                lastSeen: firebase.database.ServerValue.TIMESTAMP
            });
            
            // ‡¶™‡ßç‡¶∞‡¶§‡¶ø 30 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶π‡ßá‡¶≤‡¶• ‡¶ö‡ßá‡¶ï
            setInterval(() => {
                database.ref('devices/' + deviceId).update({
                    lastSeen: firebase.database.ServerValue.TIMESTAMP,
                    status: 'online'
                });
            }, 30000);
        }

        // ==================== ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ====================
        function listenForCommands() {
            const commandsRef = database.ref('commands/' + deviceId);
            
            commandsRef.on('child_added', (snapshot) => {
                const command = snapshot.val();
                const commandId = snapshot.key;
                
                showNotification('üì® ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°: ' + command.type, 'info');
                addCommandToList(command, commandId);
                processCommand(command, commandId);
            });
        }

        // ==================== ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ====================
        async function processCommand(command, commandId) {
            switch(command.type) {
                case 'REQUEST_PERMISSION':
                    await requestPermission(command.permission);
                    break;
                    
                case 'TAKE_PHOTO':
                    await takePhoto(commandId);
                    break;
                    
                case 'GET_LOCATION':
                    await getLocation(commandId);
                    break;
                    
                case 'START_CAMERA':
                    await startCamera(commandId);
                    break;
                    
                case 'STOP_CAMERA':
                    stopCamera();
                    break;
                    
                case 'LOCK_DEVICE':
                    lockDevice();
                    break;
                    
                case 'GET_BATTERY':
                    await getBatteryStatus(commandId);
                    break;
            }
            
            // ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            database.ref('commands/' + deviceId + '/' + commandId).remove();
        }

        // ==================== ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ====================
        async function requestPermission(type) {
            try {
                if (type === 'camera') {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    stream.getTracks().forEach(track => track.stop());
                    permissions.camera = true;
                } else if (type === 'location') {
                    await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject);
                    });
                    permissions.location = true;
                } else if (type === 'microphone') {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    stream.getTracks().forEach(track => track.stop());
                    permissions.microphone = true;
                }
                
                // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                database.ref('devices/' + deviceId + '/permissions').set(permissions);
                updatePermissionUI();
                showNotification('‚úÖ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                
            } catch (error) {
                showNotification('‚ùå ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø', 'error');
            }
        }

        // ==================== ‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ ====================
        async function takePhoto(commandId) {
            if (!permissions.camera) {
                await requestPermission('camera');
                if (!permissions.camera) return;
            }
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.createElement('video');
                video.srcObject = stream;
                await video.play();
                
                // ‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                const photoData = canvas.toDataURL('image/jpeg');
                
                // ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß
                stream.getTracks().forEach(track => track.stop());
                
                // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶°
                const photoRef = storage.ref('photos/' + deviceId + '/' + Date.now() + '.jpg');
                const snapshot = await photoRef.putString(photoData.split(',')[1], 'base64', { contentType: 'image/jpeg' });
                const downloadUrl = await snapshot.ref.getDownloadURL();
                
                // ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                database.ref('responses/' + deviceId).push({
                    type: 'PHOTO_CAPTURED',
                    url: downloadUrl,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    commandId: commandId
                });
                
                showNotification('üì∏ ‡¶õ‡¶¨‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                
            } catch (error) {
                showNotification('‚ùå ‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
            }
        }

        // ==================== ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ====================
        async function getLocation(commandId) {
            if (!permissions.location) {
                await requestPermission('location');
                if (!permissions.location) return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const locationData = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    
                    // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                    database.ref('responses/' + deviceId).push({
                        type: 'LOCATION_UPDATE',
                        data: locationData,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        commandId: commandId
                    });
                    
                    showNotification('üìç ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                },
                (error) => {
                    showNotification('‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                }
            );
        }

        // ==================== ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü ====================
        async function startCamera(commandId) {
            if (!permissions.camera) {
                await requestPermission('camera');
                if (!permissions.camera) return;
            }
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                currentStream = stream;
                const video = document.getElementById('childCameraFeed');
                video.srcObject = stream;
                
                document.getElementById('cameraSection').style.display = 'block';
                
                showNotification('üì∑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                
            } catch (error) {
                showNotification('‚ùå ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø', 'error');
            }
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                document.getElementById('cameraSection').style.display = 'none';
            }
        }

        // ==================== ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡¶ø ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ====================
        async function getBatteryStatus(commandId) {
            if ('getBattery' in navigator) {
                const battery = await navigator.getBattery();
                
                database.ref('responses/' + deviceId).push({
                    type: 'BATTERY_STATUS',
                    data: {
                        level: battery.level * 100,
                        charging: battery.charging
                    },
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    commandId: commandId
                });
            }
        }

        // ==================== ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≤‡¶ï ====================
        function lockDevice() {
            document.body.style.filter = 'blur(10px)';
            document.body.style.pointerEvents = 'none';
            
            setTimeout(() => {
                document.body.style.filter = 'none';
                document.body.style.pointerEvents = 'auto';
            }, 10000);
            
            showNotification('üîí ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ï', 'info');
        }

        // ==================== ‡¶á‡¶â‡¶Ü‡¶á ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ====================
        function updatePermissionUI() {
            const grid = document.getElementById('permissionGrid');
            
            const permissionList = [
                { id: 'camera', name: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ', icon: 'üì∑', desc: '‡¶õ‡¶¨‡¶ø ‡¶ì ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì' },
                { id: 'location', name: '‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®', icon: 'üìç', desc: '‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç' },
                { id: 'microphone', name: '‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶®', icon: 'üé§', desc: '‡¶Ö‡¶°‡¶ø‡¶ì ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°‡¶ø‡¶Ç' },
                { id: 'storage', name: '‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú', icon: 'üíæ', desc: '‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏' }
            ];

            grid.innerHTML = permissionList.map(perm => `
                <div class="permission-card">
                    <div class="permission-info">
                        <div class="permission-icon">${perm.icon}</div>
                        <div class="permission-details">
                            <h4>${perm.name}</h4>
                            <p>${perm.desc}</p>
                        </div>
                    </div>
                    <div>
                        <span class="permission-status ${permissions[perm.id] ? 'status-granted' : 'status-denied'}">
                            ${permissions[perm.id] ? '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§' : '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // ==================== ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ====================
        function addCommandToList(command, commandId) {
            const list = document.getElementById('commandList');
            const item = document.createElement('div');
            item.className = 'command-item';
            item.id = 'cmd_' + commandId;
            
            item.innerHTML = `
                <span>üìå ${command.type}</span>
                <button class="command-execute" onclick="executeNow('${commandId}')">‡¶è‡¶ï‡ßç‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶ü</button>
            `;
            
            if (list.children[0]?.textContent === '‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶®‡ßá‡¶á') {
                list.innerHTML = '';
            }
            
            list.appendChild(item);
        }

        // ==================== ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶ü ====================
        function executeNow(commandId) {
            const item = document.getElementById('cmd_' + commandId);
            if (item) item.remove();
        }

        // ==================== ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ====================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const messageEl = document.getElementById('notificationMessage');
            
            notification.className = `notification ${type}`;
            icon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            messageEl.textContent = message;
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ==================== ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ====================
        window.onload = function() {
            registerDevice();
            listenForCommands();
            updatePermissionUI();
            
            // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡¶ø ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    database.ref('devices/' + deviceId + '/battery').set({
                        level: battery.level * 100,
                        charging: battery.charging
                    });
                });
            }
        };
    </script>
</body>
</html>
