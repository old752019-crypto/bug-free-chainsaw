<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ - ‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Hind Siliguri', sans-serif;
        }

        body {
            background: linear-gradient(145deg, #0B0B2B 0%, #1A1A3A 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .app-container {
            max-width: 450px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 40px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .app-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .app-subtitle {
            color: #A0A0C0;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        /* ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
        .section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .section-title span {
            font-size: 24px;
        }

        /* ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
        .permission-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .permission-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .permission-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .permission-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea20, #764ba220);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .permission-details h4 {
            color: white;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .permission-details p {
            color: #8888A0;
            font-size: 12px;
        }

        .permission-status {
            padding: 6px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-granted {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-denied {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .permission-btn {
            background: linear-gradient(135deg, #667EEA, #764BA2);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .permission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px #667EEA80;
        }

        .permission-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶ó‡ßç‡¶∞‡¶ø‡¶° */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .control-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border-radius: 25px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .control-card:hover {
            transform: translateY(-5px);
            background: linear-gradient(145deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
            border-color: rgba(102,126,234,0.5);
        }

        .control-icon {
            font-size: 35px;
            margin-bottom: 10px;
        }

        .control-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .control-desc {
            color: #8888A0;
            font-size: 11px;
        }

        /* ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶≠‡¶ø‡¶â */
        .camera-section {
            background: #000;
            border-radius: 30px;
            overflow: hidden;
            margin-top: 20px;
            border: 2px solid rgba(102,126,234,0.3);
            position: relative;
        }

        .camera-header {
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .camera-title {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 30px;
            color: white;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .close-camera {
            background: rgba(255,59,48,0.8);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .camera-container {
            position: relative;
            width: 100%;
            aspect-ratio: 9/16;
            background: #111;
        }

        #cameraFeed, #capturedImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #capturedImage {
            display: none;
        }

        .camera-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 10;
        }

        .cam-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .cam-btn.capture {
            background: linear-gradient(135deg, #FF6B6B, #FF4757);
            width: 70px;
            height: 70px;
            font-size: 28px;
        }

        .cam-btn:hover {
            transform: scale(1.1);
        }

        /* ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â */
        .gallery-preview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .gallery-item {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 30px;
            display: none;
            align-items: center;
            gap: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            max-width: 350px;
            animation: slideIn 0.3s ease;
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 4px solid #10B981;
        }

        .notification.error {
            border-left: 4px solid #EF4444;
        }

        .notification.info {
            border-left: 4px solid #3B82F6;
        }

        /* ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶á‡¶®‡¶´‡ßã */
        .location-info {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .location-details {
            color: white;
            font-size: 14px;
            line-height: 1.8;
        }

        /* ‡¶Æ‡¶°‡¶æ‡¶≤ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            max-width: 90%;
            max-height: 80%;
            border-radius: 20px;
            overflow: hidden;
        }

        .modal-content img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
        }

        /* ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #667EEA;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="header">
            <div class="app-title">üë∂ ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</div>
            <div class="app-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶®‡ßç‡¶§‡¶æ‡¶®‡ßá‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ</div>
        </div>

        <!-- ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div class="section">
            <div class="section-title">
                <span>üîê</span>
                ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶®
            </div>
            
            <div class="permission-grid" id="permissionGrid"></div>
        </div>

        <!-- ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ -->
        <div class="section">
            <div class="section-title">
                <span>üéÆ</span>
                ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤
            </div>

            <div class="control-grid">
                <div class="control-card" onclick="openCamera()">
                    <div class="control-icon">üì∑</div>
                    <div class="control-title">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</div>
                    <div class="control-desc">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶≠‡¶ø‡¶â ‡¶ì ‡¶õ‡¶¨‡¶ø</div>
                </div>

                <div class="control-card" onclick="getLocation()">
                    <div class="control-icon">üìç</div>
                    <div class="control-title">‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®</div>
                    <div class="control-desc">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®</div>
                </div>

                <div class="control-card" onclick="openGallery()">
                    <div class="control-icon">üñºÔ∏è</div>
                    <div class="control-title">‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</div>
                    <div class="control-desc">‡¶§‡ßã‡¶≤‡¶æ ‡¶õ‡¶¨‡¶ø</div>
                </div>

                <div class="control-card" onclick="showAppList()">
                    <div class="control-icon">üì±</div>
                    <div class="control-title">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</div>
                    <div class="control-desc">‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</div>
                </div>
            </div>

            <!-- ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶á‡¶®‡¶´‡ßã -->
            <div class="location-info" id="locationInfo">
                <div class="location-details" id="locationDetails"></div>
            </div>

            <!-- ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â -->
            <div class="gallery-preview" id="galleryPreview"></div>
        </div>

        <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® (‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã) -->
        <div class="camera-section" id="cameraSection" style="display: none;">
            <div class="camera-header">
                <span class="camera-title">üì∑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</span>
                <button class="close-camera" onclick="closeCamera()">‚úï</button>
            </div>
            
            <div class="camera-container">
                <video id="cameraFeed" autoplay playsinline></video>
                <img id="capturedImage">
                
                <div class="camera-controls">
                    <button class="cam-btn" onclick="toggleCamera()">üîÑ</button>
                    <button class="cam-btn capture" onclick="capturePhoto()">üì∏</button>
                    <button class="cam-btn" onclick="toggleFlash()">‚ö°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶Æ‡¶°‡¶æ‡¶≤ -->
    <div class="modal" id="imageModal" onclick="closeModal()">
        <div class="modal-content">
            <img id="modalImage" src="">
        </div>
        <button class="close-modal" onclick="closeModal()">‚úï</button>
    </div>

    <!-- ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® -->
    <div class="notification" id="notification">
        <span id="notificationIcon">‚ÑπÔ∏è</span>
        <span id="notificationMessage"></span>
    </div>

    <script>
        // ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßá‡¶ü
        let permissions = {
            camera: false,
            location: false,
            microphone: false
        };

        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü
        let currentStream = null;
        let currentFacingMode = 'environment';
        let flashOn = false;
        let capturedPhotos = [];

        // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶§‡ßã‡¶≤‡¶æ ‡¶õ‡¶¨‡¶ø ‡¶≤‡ßã‡¶°
        function loadPhotos() {
            const saved = localStorage.getItem('capturedPhotos');
            if (saved) {
                capturedPhotos = JSON.parse(saved);
                updateGallery();
            }
        }

        // ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        function updateGallery() {
            const gallery = document.getElementById('galleryPreview');
            gallery.innerHTML = '';

            capturedPhotos.slice().reverse().slice(0, 8).forEach(photo => {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                item.onclick = () => showImage(photo.data);
                item.innerHTML = `<img src="${photo.data}" alt="Photo">`;
                gallery.appendChild(item);
            });

            // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
            if (capturedPhotos.length === 0) {
                for (let i = 0; i < 4; i++) {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.style.background = 'rgba(255,255,255,0.05)';
                    item.style.display = 'flex';
                    item.style.alignItems = 'center';
                    item.style.justifyContent = 'center';
                    item.style.color = '#666';
                    item.innerHTML = 'üì∑';
                    gallery.appendChild(item);
                }
            }
        }

        // ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
        async function checkPermissions() {
            // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                stream.getTracks().forEach(track => track.stop());
                permissions.camera = true;
            } catch (e) {
                permissions.camera = false;
            }

            // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®
            if ('geolocation' in navigator) {
                permissions.location = true;
            } else {
                permissions.location = false;
            }

            // ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶®
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                permissions.microphone = true;
            } catch (e) {
                permissions.microphone = false;
            }

            updatePermissionUI();
        }

        // ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        function updatePermissionUI() {
            const grid = document.getElementById('permissionGrid');
            
            const permissionList = [
                { id: 'camera', name: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ', icon: 'üì∑', desc: '‡¶õ‡¶¨‡¶ø ‡¶ì ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì' },
                { id: 'location', name: '‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®', icon: 'üìç', desc: '‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç' },
                { id: 'microphone', name: '‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶®', icon: 'üé§', desc: '‡¶Ö‡¶°‡¶ø‡¶ì ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°‡¶ø‡¶Ç' }
            ];

            grid.innerHTML = permissionList.map(perm => `
                <div class="permission-card">
                    <div class="permission-info">
                        <div class="permission-icon">${perm.icon}</div>
                        <div class="permission-details">
                            <h4>${perm.name}</h4>
                            <p>${perm.desc}</p>
                        </div>
                    </div>
                    <div>
                        <span class="permission-status ${permissions[perm.id] ? 'status-granted' : 'status-denied'}">
                            ${permissions[perm.id] ? '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§' : '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}
                        </span>
                        <button class="permission-btn" onclick="requestPermission('${perm.id}')" ${permissions[perm.id] ? 'disabled' : ''}>
                            ${permissions[perm.id] ? '‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡¶ø‡¶®'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü
        async function requestPermission(type) {
            try {
                if (type === 'camera') {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    stream.getTracks().forEach(track => track.stop());
                    permissions.camera = true;
                    showNotification('‚úÖ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                } else if (type === 'location') {
                    navigator.geolocation.getCurrentPosition(
                        () => {
                            permissions.location = true;
                            showNotification('‚úÖ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                            updatePermissionUI();
                        },
                        () => {
                            showNotification('‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                        }
                    );
                    return;
                } else if (type === 'microphone') {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    stream.getTracks().forEach(track => track.stop());
                    permissions.microphone = true;
                    showNotification('‚úÖ ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                }
                
                updatePermissionUI();
            } catch (e) {
                showNotification(`‚ùå ${type} ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø`, 'error');
            }
        }

        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ñ‡ßã‡¶≤‡¶æ
        async function openCamera() {
            if (!permissions.camera) {
                showNotification('üì∑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®', 'error');
                await requestPermission('camera');
                if (!permissions.camera) return;
            }

            document.getElementById('cameraSection').style.display = 'block';
            startCamera();
        }

        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ
        async function startCamera() {
            const cameraFeed = document.getElementById('cameraFeed');
            
            if (currentStream) {
                stopCamera();
            }

            try {
                const constraints = {
                    video: {
                        facingMode: currentFacingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };

                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraFeed.srcObject = currentStream;
                showNotification('üì∑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
            } catch (error) {
                showNotification('‚ùå ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                
                // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
                if (currentFacingMode === 'environment') {
                    currentFacingMode = 'user';
                    startCamera();
                }
            }
        }

        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶¨‡¶®‡ßç‡¶ß
        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶¨‡¶®‡ßç‡¶ß (UI)
        function closeCamera() {
            stopCamera();
            document.getElementById('cameraSection').style.display = 'none';
            document.getElementById('cameraFeed').style.display = 'block';
            document.getElementById('capturedImage').style.display = 'none';
        }

        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡ßÅ‡¶á‡¶ö
        function toggleCamera() {
            currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
            stopCamera();
            startCamera();
            showNotification('üîÑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'info');
        }

        // ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶ü‡¶ó‡¶≤
        function toggleFlash() {
            flashOn = !flashOn;
            showNotification(flashOn ? '‚ö° ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶ö‡¶æ‡¶≤‡ßÅ' : '‚ö° ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡¶®‡ßç‡¶ß', 'info');
            
            // ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü
            if (flashOn) {
                document.body.style.backgroundColor = '#fff';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 100);
            }
        }

        // ‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ
        function capturePhoto() {
            const cameraFeed = document.getElementById('cameraFeed');
            const capturedImage = document.getElementById('capturedImage');
            
            if (!cameraFeed.srcObject) {
                showNotification('‚ùå ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶®‡ßá‡¶á', 'error');
                return;
            }

            // ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü
            if (flashOn) {
                document.body.style.backgroundColor = 'white';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 100);
            }

            const canvas = document.createElement('canvas');
            canvas.width = cameraFeed.videoWidth;
            canvas.height = cameraFeed.videoHeight;
            canvas.getContext('2d').drawImage(cameraFeed, 0, 0);
            
            const photoData = canvas.toDataURL('image/jpeg', 0.9);
            
            // ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            capturedImage.src = photoData;
            capturedImage.style.display = 'block';
            cameraFeed.style.display = 'none';
            
            // ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
            capturedPhotos.push({
                id: Date.now(),
                data: photoData,
                timestamp: new Date().toLocaleString()
            });
            
            // ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ 20‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶ø
            if (capturedPhotos.length > 20) {
                capturedPhotos = capturedPhotos.slice(-20);
            }
            
            localStorage.setItem('capturedPhotos', JSON.stringify(capturedPhotos));
            updateGallery();
            
            showNotification('‚úÖ ‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            
            // 2 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶¨‡¶®‡ßç‡¶ß
            setTimeout(() => {
                capturedImage.style.display = 'none';
                cameraFeed.style.display = 'block';
            }, 2000);
        }

        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ
        function getLocation() {
            if (!permissions.location) {
                showNotification('üìç ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®', 'error');
                requestPermission('location');
                return;
            }

            showNotification('üìç ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    const locationInfo = document.getElementById('locationInfo');
                    const locationDetails = document.getElementById('locationDetails');
                    
                    locationDetails.innerHTML = `
                        <strong>‡¶Ö‡¶ï‡ßç‡¶∑‡¶æ‡¶Ç‡¶∂:</strong> ${lat.toFixed(6)}<br>
                        <strong>‡¶¶‡ßç‡¶∞‡¶æ‡¶ò‡¶ø‡¶Æ‡¶æ‡¶Ç‡¶∂:</strong> ${lng.toFixed(6)}<br>
                        <strong>‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡ßÅ‡¶≤‡¶§‡¶æ:</strong> ¬±${accuracy.toFixed(1)} ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞<br>
                        <strong>‡¶∏‡¶Æ‡¶Ø‡¶º:</strong> ${new Date().toLocaleString()}<br>
                        <button class="permission-btn" style="margin-top:10px;" onclick="window.open('https://www.google.com/maps?q=${lat},${lng}')">
                            üó∫Ô∏è ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                        </button>
                    `;
                    
                    locationInfo.style.display = 'block';
                    showNotification('‚úÖ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá', 'success');
                },
                (error) => {
                    let message = '‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø';
                    if (error.code === 1) message = '‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                    if (error.code === 2) message = '‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶Ü‡¶õ‡ßá';
                    if (error.code === 3) message = '‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü';
                    
                    showNotification(`‚ùå ${message}`, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶ñ‡ßã‡¶≤‡¶æ
        function openGallery() {
            if (capturedPhotos.length === 0) {
                showNotification('üñºÔ∏è ‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡ßá‡¶á', 'info');
                return;
            }
            
            // ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶≠‡¶ø‡¶â
            const gallery = document.getElementById('galleryPreview');
            gallery.scrollIntoView({ behavior: 'smooth' });
        }

        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        function showAppList() {
            const apps = [
                'üì± ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï', 'üì± ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™', 'üì± ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨', 'üì± ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶æ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ',
                'üì± ‡¶ü‡¶ø‡¶ï‡¶ü‡¶ï', 'üì± ‡¶ó‡ßá‡¶Æ‡¶∏', 'üì± ‡¶ï‡ßç‡¶∞‡ßã‡¶Æ', 'üì± ‡¶Æ‡ßá‡¶∏‡ßá‡¶û‡ßç‡¶ú‡¶æ‡¶∞'
            ];
            
            let message = '‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™:\n' + apps.map((app, i) => `${i+1}. ${app}`).join('\n');
            alert(message);
            showNotification('üì± ‡ßÆ‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá', 'info');
        }

        // ‡¶õ‡¶¨‡¶ø ‡¶¨‡¶°‡¶º ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        function showImage(data) {
            document.getElementById('modalImage').src = data;
            document.getElementById('imageModal').style.display = 'flex';
        }

        // ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const messageEl = document.getElementById('notificationMessage');
            
            notification.className = `notification ${type}`;
            
            switch(type) {
                case 'success':
                    icon.textContent = '‚úÖ';
                    break;
                case 'error':
                    icon.textContent = '‚ùå';
                    break;
                default:
                    icon.textContent = '‚ÑπÔ∏è';
            }
            
            messageEl.textContent = message;
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßá‡¶ï
        function checkBrowserSupport() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ', 'error');
            }
        }

        // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶∞
        window.onload = function() {
            checkBrowserSupport();
            checkPermissions();
            loadPhotos();
            
            // ‡¶™‡ßç‡¶∞‡¶§‡¶ø 30 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
            setInterval(checkPermissions, 30000);
        };

        // ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶≤‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶¨‡¶®‡ßç‡¶ß
        window.onbeforeunload = function() {
            stopCamera();
        };
    </script>
</body>
</html>
