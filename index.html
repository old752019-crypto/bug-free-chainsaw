<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Professional Dark Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Hind Siliguri', sans-serif; }
        body { background: #000000; color: #e0e0e0; padding-bottom: 80px; min-height: 100vh; overflow-x: hidden; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; background: #121212; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(255,255,255,0.05); height: 60px; }
        .header h2 { color: #ffffff; font-size: 18px; font-weight: 700; position: absolute; left: 50%; transform: translateX(-50%); }
        .balance-badge { background: #1b5e20; color: #ffffff; padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 14px; border: 1px solid #2e7d32; }
        .badge { position: absolute; top: -5px; right: -5px; background: red; color: white; font-size: 10px; width: 17px; height: 17px; border-radius: 50%; display: none; justify-content: center; align-items: center; font-weight: bold; border: 1px solid white; }

        /* Notice Bar */
        .notice-container { background: #1a1a1a; margin: 5px 15px 15px; border-radius: 30px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.5); border: 1px solid #333; overflow: hidden; height: 40px; padding: 0 15px; position: relative; }
        .notice-container i { color: #ffffff; margin-right: 10px; z-index: 11; background: #1a1a1a; padding-right: 5px; }
        .marquee-box { flex: 1; overflow: hidden; position: relative; height: 100%; display: flex; align-items: center; }
        #marquee-text { white-space: nowrap; position: absolute; left: 100%; animation: marquee-anim 15s linear infinite; font-size: 14px; color: #bbb; font-weight: 500; display: inline-block; }
        @keyframes marquee-anim { 0% { left: 100%; } 100% { left: -150%; } }

        /* Banner Slider */
        .banner-container { padding: 15px; position: relative; }
        .banner-wrapper { display: flex; overflow-x: hidden; scroll-behavior: smooth; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); height: 180px; background: #121212; position: relative; }
        .slide { min-width: 100%; height: 100%; position: relative; }
        .slide img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.6); }
        .slide-content { position: absolute; bottom: 25px; left: 20px; right: 20px; color: white; z-index: 5; }
        .slide-content h3 { font-size: 18px; font-weight: 700; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .slide-content p { font-size: 12px; opacity: 0.9; text-shadow: 0 1px 3px rgba(0,0,0,0.8); line-height: 1.3; }
        .dots-container { display: flex; justify-content: center; gap: 6px; margin-top: -25px; position: relative; z-index: 10; padding-bottom: 15px; }
        .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.3); border-radius: 50%; transition: 0.3s; }
        .dot.active { background: white; width: 18px; border-radius: 10px; }

        /* Navigation Views */
        .view-section { display: none; padding-bottom: 20px; animation: slideUp 0.4s ease; }
        .active-view { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Runtime Box */
        .runtime-box { background: linear-gradient(135deg, #0d1231 0%, #1a237e 100%); margin: 0 15px 15px; padding: 15px; border-radius: 15px; text-align: center; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 1px solid #1a237e; }
        .timer-digits { display: flex; justify-content: center; gap: 8px; margin-top: 8px; }
        .digit { background: rgba(255,255,255,0.05); padding: 5px; border-radius: 6px; min-width: 45px; border: 1px solid rgba(255,255,255,0.1); }
        .digit b { display: block; font-size: 16px; }
        .digit small { font-size: 9px; opacity: 0.8; }

        /* Product Cards */
        .product-card { background: #1a1a1a; margin: 15px; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 1px solid #333; }
        .product-img { width: 100%; height: 150px; object-fit: cover; }
        .product-body { padding: 15px; }
        .product-body h4 { color: #fff; margin-bottom: 10px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 10px 0; }
        .info-item { background: #121212; padding: 8px; border-radius: 8px; text-align: center; font-size: 12px; border: 1px solid #222; }
        .info-item b { display: block; color: #3949ab; font-size: 14px; }
        .btn-buy { width: 100%; padding: 12px; background: #1a237e; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-buy:disabled { background: #333 !important; color: #777; cursor: not-allowed; }

        /* Invest/History Card */
        .invest-card { background: #1a1a1a; margin: 10px 15px; padding: 15px; border-radius: 12px; border-left: 5px solid #2e7d32; box-shadow: 0 3px 10px rgba(0,0,0,0.5); border: 1px solid #333; border-left-width: 5px; }
        .claim-bar { height: 8px; background: #222; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .claim-progress { height: 100%; background: #4caf50; width: 0%; transition: 0.3s; }
        .btn-claim { width: 100%; padding: 10px; background: #e65100; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-claim:disabled { background: #333; cursor: not-allowed; opacity: 0.6; color: #888; }

        /* Tools Grid */
        .tools-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 15px; }
        .tool-item { background: #1a1a1a; padding: 15px 5px; border-radius: 12px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.5); cursor: pointer; border: 1px solid #333; }
        .tool-item i { font-size: 24px; color: #5c6bc0; margin-bottom: 8px; }
        .tool-item span { font-size: 12px; font-weight: 600; display: block; color: #ddd; }

        /* Profile Menu */
        .profile-list { margin: 15px; background: #1a1a1a; border-radius: 15px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.5); border: 1px solid #333; }
        .list-item { display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #222; cursor: pointer; transition: 0.2s; color: #ddd; }
        .list-item:active { background: #222; }
        .list-item i { width: 35px; font-size: 18px; color: #5c6bc0; }
        .list-item span { flex: 1; font-size: 15px; font-weight: 500; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #121212; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 1000; height: 65px; }
        .nav-item { text-align: center; color: #666; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: #ffffff; transform: translateY(-5px); font-weight: bold; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 2000; padding: 20px; }
        .modal-content { background: #1a1a1a; padding: 25px; border-radius: 20px; width: 100%; max-width: 380px; position: relative; max-height: 90vh; overflow-y: auto; border: 1px solid #333; color: #fff; }
        .auth-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #333; border-radius: 10px; outline: none; background: #000; color: #fff; }
        
        #payment-methods { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .payment-item { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px; border: 1px solid #333; border-radius: 12px; cursor: pointer; background: #121212; }
        .payment-item img { width: 45px; height: 45px; border-radius: 8px; object-fit: contain; background: #fff; padding: 2px; }

        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 10px; float: right; }
        .pending { background: #e65100; color: white; }
        .success { background: #2e7d32; color: white; }
        .expired { background: #d32f2f; color: white; }

        .helpline-btn { display: flex; flex-direction: row; align-items: center; gap: 15px; padding: 15px; background: #121212; border-radius: 15px; border: 1px solid #333; cursor: pointer; transition: 0.3s; text-decoration: none; color: #fff; margin-bottom: 12px; }
        .helpline-btn:hover { background: #1a237e; border-color: #5c6bc0; }
        .helpline-btn i { font-size: 30px; color: #26A5E4; }
        .helpline-info { text-align: left; }
        .helpline-info b { display: block; font-size: 16px; margin-bottom: 2px; }
        .helpline-info small { font-size: 11px; color: #aaa; }

        #app-info-body { line-height: 1.6; color: #ddd; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">
        <i class="fa-solid fa-circle-user" style="font-size: 24px; color: #5c6bc0;" onclick="window.switchView('me')"></i>
        <h2 id="app-name">Dashboard</h2>
        <div style="display:flex; align-items:center; gap:10px;">
            <div id="user-bal" class="balance-badge">‡ß≥ 0.00</div>
            <div style="position:relative; cursor: pointer;" onclick="window.openNotify()">
                <i class="fa-solid fa-bell" style="font-size:22px; color:#5c6bc0;"></i>
                <span class="badge" id="notify-badge">0</span>
            </div>
        </div>
    </div>

    <div id="home-view" class="view-section active-view">
        <div class="banner-container">
            <div class="banner-wrapper" id="banner-list"></div>
            <div class="dots-container" id="dots-list"></div>
        </div>

        <div class="notice-container">
            <i class="fa-solid fa-bullhorn"></i>
            <div class="marquee-box">
                <span id="marquee-text">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>
            </div>
        </div>

        <div class="runtime-box">
            <span>‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶Æ‡ßü</span>
            <div class="timer-digits" id="timer-display">
                <div class="digit"><b id="d">0</b><small>‡¶¶‡¶ø‡¶®</small></div>
                <div class="digit"><b id="h">0</b><small>‡¶ò‡¶£‡ßç‡¶ü‡¶æ</small></div>
                <div class="digit"><b id="m">0</b><small>‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</small></div>
                <div class="digit"><b id="s">0</b><small>‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°</small></div>
            </div>
        </div>

        <div id="products-container"></div>
    </div>

    <div id="invest-view" class="view-section">
        <h3 style="padding: 20px 15px 5px; color: #fff;"><i class="fa-solid fa-bolt" style="color:#f1c40f;"></i> ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó</h3>
        <div id="my-investments"></div>
    </div>

    <div id="invite-view" class="view-section">
        <div style="background: linear-gradient(135deg, #1a237e, #0d1231); padding: 30px 20px; text-align: center; border-radius: 0 0 20px 20px; margin-bottom: 20px;">
            <i class="fa-solid fa-share-nodes" style="font-size: 50px; color: #fff; margin-bottom: 10px;"></i>
            <h3 style="color: white;">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ú‡¶æ‡¶®‡¶æ‡¶®</h3>
            <p style="font-size: 13px; color: #ccc;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>
        
        <div id="invite-missions-container"></div>

        <div style="background: #1a1a1a; margin: 15px; padding: 20px; border-radius: 15px; border: 1px solid #333; text-align: center;">
            <p style="margin-bottom: 10px; font-size: 14px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï:</p>
            <div style="background: #000; padding: 10px; border-radius: 8px; font-size: 12px; color: #5c6bc0; word-break: break-all; margin-bottom: 15px;" id="ref-link-display">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            <button class="btn-buy" id="btn-invite-share"><i class="fa-solid fa-share-nodes"></i> ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ì ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="tools-view" class="view-section">
        <h3 style="padding: 20px 15px 5px; color: #fff;">‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
        <div class="tools-grid">
            <div class="tool-item" onclick="window.openTopup()">
                <i class="fa-solid fa-wallet"></i>
                <span>Topup</span>
            </div>
            <div class="tool-item" onclick="window.openWithdraw()">
                <i class="fa-solid fa-money-bill-transfer"></i>
                <span>Withdraw</span>
            </div>
            <div class="tool-item" onclick="window.openAppInfo()">
                <i class="fa-solid fa-circle-info" style="color: #ff9800;"></i>
                <span>App Info</span>
            </div>
            <div class="tool-item" onclick="window.switchView('history')">
                <i class="fa-solid fa-clock-rotate-left"></i>
                <span>History</span>
            </div>
            <div class="tool-item" onclick="window.openHelpline()">
                <i class="fa-solid fa-headset" style="color: #4caf50;"></i>
                <span>Helpline</span>
            </div>
            <div class="tool-item" onclick="window.switchView('invite')">
                <i class="fa-solid fa-share-nodes"></i>
                <span>Invite</span>
            </div>
        </div>
    </div>

    <div id="expired-view" class="view-section">
        <h3 style="padding: 20px 15px 5px; color: #fff;"><i class="fa-solid fa-history"></i> ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶‡ßã‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£ ‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó</h3>
        <div id="expired-investments"></div>
    </div>

    <div id="history-view" class="view-section">
        <h3 style="padding: 20px 15px 5px; color: #fff;">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶ì ‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
        <div id="history-list"></div>
    </div>

    <div id="me-view" class="view-section">
        <div style="background: linear-gradient(135deg, #121212 0%, #1a237e 100%); color:white; padding:45px 20px; text-align:center; border-radius:0 0 30px 30px; position: relative; border-bottom: 1px solid #333;">
            <i class="fa-solid fa-user-circle" style="font-size:80px; border: 4px solid rgba(255,255,255,0.1); border-radius: 50%;"></i>
            <h2 id="u-name">Guest</h2>
            <p id="u-phone">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            <div id="u-uid-tag" style="position: absolute; top: 15px; right: 20px; font-size: 11px; background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 20px;">UID: 000000</div>
        </div>

        <div class="profile-list">
            <div class="list-item" onclick="window.switchView('invest')"><i class="fa-solid fa-chart-pie"></i><span>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü</span></div>
            <div class="list-item" onclick="window.switchView('expired')"><i class="fa-solid fa-calendar-xmark"></i><span>‡¶Æ‡ßá‡ßü‡¶æ‡¶¶‡ßã‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£ ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü</span></div>
            <div class="list-item" onclick="window.openTopup()"><i class="fa-solid fa-credit-card"></i><span>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (Topup)</span></div>
            <div class="list-item" onclick="window.openWithdraw()"><i class="fa-solid fa-money-bill-transfer"></i><span>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® (Withdraw)</span></div>
            <div id="logout-item" class="list-item" style="color: #ff5252;" onclick="window.logoutAction()"><i class="fa-solid fa-right-from-bracket" style="color: #ff5252;"></i><span>‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</span></div>
        </div>
    </div>

    <div id="app-info-modal" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('app-info-modal').style.display='none'" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
            <h3 id="app-info-title" style="margin-bottom:20px; text-align:center; color: #ff9800;">App Information</h3>
            <div id="app-info-body">‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>
    </div>

    <div id="helpline-modal" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('helpline-modal').style.display='none'" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
            <h3 style="margin-bottom:20px; text-align:center;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <div id="helpline-list-container"></div>
        </div>
    </div>

    <div id="topup-modal" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('topup-modal').style.display='none'" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
            <h3 style="margin-bottom:20px; text-align:center;">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <div id="payment-methods"></div>
        </div>
    </div>

    <div id="deposit-form-modal" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('deposit-form-modal').style.display='none'" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
            <h3 style="text-align:center; margin-bottom:15px;">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ</h3>
            <div style="background:#000; padding:15px; border-radius:12px; border:1px dashed #333; text-align:center; margin-bottom:15px;">
                <h2 id="dep-number" style="margin:5px 0; color: #fff;">01XXXXXXXXX</h2>
                <button onclick="window.copyNum()" style="background:#5c6bc0; color:white; border:none; padding:5px 12px; border-radius:5px; cursor:pointer; font-size:12px;">COPY NUMBER</button>
                <p id="dep-info" style="margin-top:10px; font-weight:bold; font-size:14px; color:#5c6bc0;"></p>
            </div>
            <input type="text" id="dep-sender" class="auth-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
            <input type="text" id="dep-trx" class="auth-input" placeholder="Transaction ID">
            <input type="number" id="dep-amount" class="auth-input" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
            <button class="btn-buy" style="background:#2e7d32; margin-top:10px;" onclick="window.submitDeposit()">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="withdraw-modal" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('withdraw-modal').style.display='none'" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
            <h3 style="text-align:center; margin-bottom:15px;">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h3>
            <select id="w-method" class="auth-input">
                <option value="Bkash">Bkash</option>
                <option value="Nagad">Nagad</option>
            </select>
            <input type="text" id="w-number" class="auth-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
            <input type="number" id="w-amount" class="auth-input" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
            <button class="btn-buy" style="background:#c62828;" onclick="window.submitWithdraw()">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h3 id="auth-title" style="text-align:center;">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <div id="login-form">
                <input type="text" id="l-phone" class="auth-input" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                <input type="password" id="l-pass" class="auth-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                <button class="btn-buy" onclick="window.login()">‡¶≤‡¶ó‡¶á‡¶®</button>
                <p style="text-align:center; margin-top:15px; color:#5c6bc0; cursor:pointer;" onclick="window.toggleAuth('signup')">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</p>
            </div>
            <div id="signup-form" style="display:none;">
                <input type="text" id="s-name" class="auth-input" placeholder="‡¶®‡¶æ‡¶Æ">
                <input type="text" id="s-phone" class="auth-input" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                <input type="password" id="s-pass" class="auth-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                <input type="password" id="s-confirm-pass" class="auth-input" placeholder="‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                <button class="btn-buy" onclick="window.signup()">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button>
                <p style="text-align:center; margin-top:15px; color:#5c6bc0; cursor:pointer;" onclick="window.toggleAuth('login')">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
        </div>
    </div>

    <div id="notify-modal" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('notify-modal').style.display='none'" style="float:right; cursor:pointer; font-size:26px;">&times;</span>
            <h3 style="margin-bottom:15px; color: #fff;"><i class="fa-solid fa-bell" style="color:#f1c40f;"></i> ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶™‡ßç‡¶§‡¶ø</h3>
            <div id="notify-items"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="nav-home" onclick="window.switchView('home')"><i class="fa-solid fa-house"></i>‡¶π‡ßã‡¶Æ</div>
        <div class="nav-item" id="nav-invest" onclick="window.switchView('invest')"><i class="fa-solid fa-chart-line"></i>‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü</div>
        <div class="nav-item" id="nav-tools" onclick="window.switchView('tools')"><i class="fa-solid fa-toolbox"></i>‡¶∏‡¶∞‡¶û‡ßç‡¶ú‡¶æ‡¶Æ</div>
        <div class="nav-item" id="nav-me" onclick="window.switchView('me')"><i class="fa-solid fa-user"></i>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, push, get, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAbZ7kikSFRQt5jIIkfM_q0s3A00zzpn-w",
            authDomain: "twbv-55156.firebaseapp.com",
            projectId: "twbv-55156",
            storageBucket: "twbv-55156.firebasestorage.app",
            messagingSenderId: "821079100098",
            appId: "1:821079100098:web:2b5d32565a1476d015495b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- REFERRAL PARAMETER HANDLING ---
        const urlParams = new URLSearchParams(window.location.search);
        const referrerUID = urlParams.get('ref');
        if (referrerUID) {
            localStorage.setItem('pendingReferrer', referrerUID);
        }

        let userData = null;
        let selectedPayMethod = "";
        let currentSlide = 0;
        let slideInterval;
        let claimTimers = {};

        function isUserLoggedIn() { return localStorage.getItem('userPhone') !== null; }
        
        function forceLogin() { 
            document.getElementById('auth-modal').style.display = 'flex'; 
            history.pushState(null, ""); 
        }

        window.claimProfit = (invId, dailyAmount) => {
            if (!userData || !userData.investments || !userData.investments[invId]) return;
            const inv = userData.investments[invId];
            const nextDaysCount = (inv.daysCount || 0) + 1;
            const updates = {};
            updates[`users/${phone}/balance`] = parseFloat(userData.balance) + parseFloat(dailyAmount);
            updates[`users/${phone}/investments/${invId}/lastClaim`] = Date.now();
            updates[`users/${phone}/investments/${invId}/daysCount`] = nextDaysCount;
            if (nextDaysCount >= inv.totalDays) updates[`users/${phone}/investments/${invId}/status`] = 'Expired';
            update(ref(db), updates).then(() => { alert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡ß≥${dailyAmount} ‡¶Æ‡ßÅ‡¶®‡¶æ‡¶´‡¶æ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`); });
        };

        window.openAppInfo = () => {
            document.getElementById('app-info-modal').style.display = 'flex';
            history.pushState(null, "");
            get(child(ref(db), 'appInfo')).then((snapshot) => {
                const infoBody = document.getElementById('app-info-body');
                const infoTitle = document.getElementById('app-info-title');
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    infoTitle.innerText = data.title || "App Information";
                    infoBody.innerHTML = (data.content || "‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§").replace(/\n/g, '<br>');
                } else infoBody.innerText = "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá‡¶®‡¶ø‡•§";
            });
        };

        window.openHelpline = () => {
            document.getElementById('helpline-modal').style.display = 'flex';
            history.pushState(null, "");
        };

        window.openWithdraw = () => { 
            if(!isUserLoggedIn()) return forceLogin(); 
            document.getElementById('withdraw-modal').style.display = 'flex'; 
            history.pushState(null, "");
        };

        window.openTopup = () => { 
            if(!isUserLoggedIn()) return forceLogin(); 
            document.getElementById('topup-modal').style.display = 'flex'; 
            history.pushState(null, "");
        };

        window.openNotify = () => {
            document.getElementById('notify-modal').style.display = 'flex';
            history.pushState(null, "");
        };

        window.openDepositForm = (m) => { 
            selectedPayMethod = m.name; 
            document.getElementById('topup-modal').style.display = 'none'; 
            document.getElementById('deposit-form-modal').style.display = 'flex'; 
            document.getElementById('dep-number').innerText = m.number; 
            document.getElementById('dep-info').innerText = "‡¶ü‡¶æ‡¶á‡¶™: " + m.type; 
        };

        window.switchView = (v) => { 
            if((v === 'invest' || v === 'me' || v === 'expired' || v === 'invite') && !isUserLoggedIn()) return forceLogin(); 
            
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active-view')); 
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); 
            
            const targetView = document.getElementById(v + '-view');
            if(targetView) {
                targetView.classList.add('active-view'); 
                if(document.getElementById('nav-' + v)) document.getElementById('nav-' + v).classList.add('active'); 
            }
        };

        window.addEventListener('popstate', (event) => {
            const modals = document.querySelectorAll('.modal');
            let modalWasOpen = false;

            modals.forEach(m => {
                if (window.getComputedStyle(m).display === 'flex') {
                    m.style.display = 'none';
                    modalWasOpen = true;
                }
            });

            if (!modalWasOpen) {
                if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                    window.close();
                } else {
                    history.pushState(null, "");
                }
            }
        });

        history.replaceState(null, "");
        history.pushState(null, "");

        // --- INVITE/SHARE LOGIC ---
        const shareInviteAction = async () => {
            const linkDisplay = document.getElementById('ref-link-display');
            if (!linkDisplay) return;
            const link = linkDisplay.innerText;
            if (link === "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...") {
                alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }
            try {
                await navigator.clipboard.writeText(link);
                if (navigator.share) {
                    await navigator.share({
                        title: '‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®',
                        text: '‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶á‡¶®‡¶≠‡¶æ‡¶á‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡¶™‡¶®‡¶ø‡¶ì ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®!',
                        url: link
                    });
                } else {
                    alert("‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                }
            } catch (err) {
                console.error("Action failed", err);
                alert("‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            }
        };

        document.addEventListener('click', (e) => {
            const btn = e.target.closest('#btn-invite-share');
            if (btn) shareInviteAction();
        });

        // --- REFERRAL PROCESSING FUNCTION ---
        async function processReferral(refUID) {
            const usersRef = ref(db, 'users');
            get(usersRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const allUsers = snapshot.val();
                    for (let userPhone in allUsers) {
                        if (allUsers[userPhone].uid == refUID) {
                            const currentCount = allUsers[userPhone].referCount || 0;
                            update(ref(db, 'users/' + userPhone), {
                                referCount: currentCount + 1
                            });
                            break; 
                        }
                    }
                }
            });
        }

        onValue(ref(db), (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            if(data.config) {
                document.getElementById('app-name').innerText = data.config.appName || "Platform";
                document.getElementById('marquee-text').innerText = data.config.notice || "";
                startSystemTimer(data.config.startTime);
            }

            if(data.banners) {
                const bList = document.getElementById('banner-list');
                const dList = document.getElementById('dots-list');
                const banners = Object.values(data.banners).reverse();
                if(bList && dList) {
                   bList.innerHTML = ""; dList.innerHTML = "";
                   banners.forEach((b, i) => {
                       const slideHtml = `<div class="slide"><img src="${b.url}">${(b.title || b.desc) ? `<div class="slide-content">${b.title ? `<h3>${b.title}</h3>` : ''}${b.desc ? `<p>${b.desc}</p>` : ''}</div>` : ''}</div>`;
                       bList.innerHTML += slideHtml;
                       dList.innerHTML += `<div class="dot ${i===0?'active':''}"></div>`;
                   });
                   initAutoSlider(banners.length);
                }
            }

            if(data.helplines) {
                const helplineContainer = document.getElementById('helpline-list-container');
                helplineContainer.innerHTML = "";
                Object.values(data.helplines).forEach(item => {
                    const linkBox = document.createElement('a');
                    linkBox.href = item.link || "#";
                    linkBox.className = "helpline-btn";
                    linkBox.target = "_blank";
                    linkBox.innerHTML = `<i class="fa-brands fa-telegram"></i><div class="helpline-info"><b>${item.title || 'Support'}</b><small>${item.subtitle || 'Click to join'}</small></div>`;
                    helplineContainer.appendChild(linkBox);
                });
            }

            if(data.inviteConfig) {
                const refLink = `${data.inviteConfig.baseLink}?ref=${userData ? userData.uid : '000000'}`;
                const displayDiv = document.getElementById('ref-link-display');
                if(displayDiv) displayDiv.innerText = refLink;
                
                const inviteCont = document.getElementById('invite-missions-container');
                if(inviteCont) {
                    inviteCont.innerHTML = "";
                    if(data.inviteMissions) {
                        Object.entries(data.inviteMissions).forEach(([id, mission]) => {
                            const isClaimed = userData && userData.claimedInvites && userData.claimedInvites[id];
                            const currentRefers = userData && userData.referCount ? userData.referCount : 0;
                            const canClaim = currentRefers >= mission.requiredCount && !isClaimed;

                            inviteCont.innerHTML += `
                                <div class="invest-card" style="border-left-color: ${isClaimed ? '#4caf50' : '#5c6bc0'}">
                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                        <b>${mission.title}</b>
                                        <span style="color:#f1c40f; font-weight:bold;">‡ß≥${mission.reward}</span>
                                    </div>
                                    <p style="font-size:12px; color:#aaa; margin:5px 0;">‡¶∂‡¶∞‡ßç‡¶§: ${mission.requiredCount} ‡¶ú‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶ú‡ßü‡ßá‡¶®‡•§</p>
                                    <div class="claim-bar">
                                        <div class="claim-progress" style="width: ${Math.min((currentRefers/mission.requiredCount)*100, 100)}%"></div>
                                    </div>
                                    <button class="btn-claim" 
                                        ${canClaim ? '' : 'disabled'} 
                                        onclick="window.claimInviteReward('${id}', ${mission.reward})"
                                        style="background: ${isClaimed ? '#333' : (canClaim ? '#2e7d32' : '#e65100')}">
                                        ${isClaimed ? '‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§' : (canClaim ? '‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶®‡¶ø‡¶®' : `‡¶¨‡¶æ‡¶ï‡¶ø ${mission.requiredCount - currentRefers} ‡¶ú‡¶®`)}
                                    </button>
                                </div>`;
                        });
                    }
                }
            }

            if(data.products) {
                const pCont = document.getElementById('products-container');
                pCont.innerHTML = "";
                let purchasedPlans = [];
                if(userData && userData.investments) purchasedPlans = Object.values(userData.investments).map(inv => inv.planId);
                Object.entries(data.products).reverse().forEach(([id, p]) => {
                    const isBought = purchasedPlans.includes(id);
                    pCont.innerHTML += `<div class="product-card"><img src="${p.img}" class="product-img"><div class="product-body"><h4>${p.title}</h4><div class="info-grid"><div class="info-item">‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø<b>‡ß≥${p.price}</b></div><div class="info-item">‡¶¶‡ßà‡¶®‡¶ø‡¶ï<b>‡ß≥${p.daily}</b></div><div class="info-item">‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü<b>‡ß≥${p.total}</b></div><div class="info-item">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶<b>${p.days} ‡¶¶‡¶ø‡¶®</b></div></div>${isBought ? `<button class="btn-buy" disabled>Sold Out</button>` : `<button class="btn-buy" onclick="window.buyPlan('${id}', ${p.price})">‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>`}</div></div>`;
                });
            }

            if(data.payments) {
                const payList = document.getElementById('payment-methods');
                payList.innerHTML = "";
                Object.values(data.payments).forEach(m => {
                    const div = document.createElement('div');
                    div.className = 'payment-item';
                    div.innerHTML = `<img src="${m.logo}"> <b>${m.name}</b>`;
                    div.onclick = () => window.openDepositForm(m);
                    payList.appendChild(div);
                });
            }

            const nBadge = document.getElementById('notify-badge');
            if(data.notifications) {
                const notes = Object.values(data.notifications).reverse();
                nBadge.innerText = notes.length; nBadge.style.display = 'flex';
                document.getElementById('notify-items').innerHTML = notes.map(n => `<div style="padding:10px; border-bottom:1px solid #222;"><b>üì¢ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ</b><p>${n.text}</p><small>${n.time}</small></div>`).join('');
            } else nBadge.style.display = 'none';

            renderHistory(data);
        });

        const phone = localStorage.getItem('userPhone');
        if(phone) {
            onValue(ref(db, 'users/' + phone), (snap) => {
                userData = snap.val();
                if(userData) {
                    if(userData.status === 'Banned') { alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); window.logoutAction(true); }
                    document.getElementById('user-bal').innerText = `‡ß≥ ${parseFloat(userData.balance).toFixed(2)}`;
                    document.getElementById('u-name').innerText = userData.name;
                    document.getElementById('u-phone').innerText = phone;
                    document.getElementById('u-uid-tag').innerText = "UID: " + (userData.uid || "000000");
                    renderUserInvestments();
                }
            });
        }

        window.claimInviteReward = (missionId, amount) => {
            if(!userData) return;
            const updates = {};
            updates[`users/${phone}/balance`] = parseFloat(userData.balance) + parseFloat(amount);
            updates[`users/${phone}/claimedInvites/${missionId}`] = true;
            update(ref(db), updates).then(() => { alert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡ß≥${amount} ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`); });
        };

        window.submitWithdraw = () => {
            const m = document.getElementById('w-method').value, n = document.getElementById('w-number').value, a = parseFloat(document.getElementById('w-amount').value);
            if(!n || !a) return alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");
            if(a < 500) return alert("‡¶®‡ßÇ‡¶®‡ßç‡¶Ø‡¶§‡¶Æ ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá");
            if(userData.balance < a) return alert("‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!");
            const updates = {};
            updates[`users/${phone}/balance`] = userData.balance - a;
            const newRef = push(ref(db, 'withdrawals'));
            updates[`withdrawals/${newRef.key}`] = { phone, method: m, number: n, amount: a, status: "Pending", time: new Date().toLocaleString() };
            update(ref(db), updates).then(() => { alert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); document.getElementById('withdraw-modal').style.display = 'none'; });
        };

        window.submitDeposit = () => { 
            const s = document.getElementById('dep-sender').value, t = document.getElementById('dep-trx').value, a = parseFloat(document.getElementById('dep-amount').value); 
            if(!s || !t || !a) return alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!"); 
            push(ref(db, 'deposits'), { phone, sender: s, trxID: t, amount: a, method: selectedPayMethod, status: "Pending", time: new Date().toLocaleString() }).then(() => { alert("‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); document.getElementById('deposit-form-modal').style.display = 'none'; }); 
        };

        window.buyPlan = (pId, price) => {
            if(!isUserLoggedIn()) return forceLogin();
            if(userData.balance < price) return alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!");
            get(child(ref(db), 'products/'+pId)).then(snap => {
                const p = snap.val();
                const newInv = { planId: pId, title: p.title, daily: p.daily, totalDays: p.days, daysCount: 0, lastClaim: 0, status: 'Active' };
                const updates = {};
                updates[`users/${phone}/balance`] = userData.balance - price;
                const newInvKey = push(child(ref(db), `users/${phone}/investments`)).key;
                updates[`users/${phone}/investments/${newInvKey}`] = newInv;
                update(ref(db), updates).then(() => { alert("‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); });
            });
        };

        window.copyNum = () => { navigator.clipboard.writeText(document.getElementById('dep-number').innerText).then(() => alert("‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!")); };
        
        window.login = () => { 
            const p = document.getElementById('l-phone').value, ps = document.getElementById('l-pass').value; 
            get(child(ref(db), 'users/'+p)).then(snap => { 
                if(snap.exists() && snap.val().pass === ps) { 
                    localStorage.setItem('userPhone', p); 
                    location.reload(); 
                } else alert("‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø!"); 
            }); 
        };

        // --- UPDATED SIGNUP FUNCTION WITH REFERRAL LOGIC ---
        window.signup = () => { 
            const n = document.getElementById('s-name').value;
            const p = document.getElementById('s-phone').value;
            const ps = document.getElementById('s-pass').value;
            const cps = document.getElementById('s-confirm-pass').value;

            if(!n || !p || !ps || !cps) return alert("‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
            if(ps !== cps) return alert("‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßá‡¶≤‡ßá‡¶®‡¶ø!");
            if(ps.length < 6) return alert("‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®");

            get(child(ref(db), 'users/'+p)).then(snap => {
                if(snap.exists()) {
                    alert("‡¶è‡¶á ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                } else {
                    const newUserUID = Math.floor(100000 + Math.random() * 900000);
                    const savedReferrerUID = localStorage.getItem('pendingReferrer');

                    const userDataObj = { 
                        name: n, 
                        pass: ps, 
                        balance: 50.00, 
                        referCount: 0, 
                        status: 'Active', 
                        uid: newUserUID,
                        referredBy: savedReferrerUID || null
                    };

                    set(ref(db, 'users/'+p), userDataObj).then(() => { 
                        if (savedReferrerUID) {
                            processReferral(savedReferrerUID);
                        }
                        localStorage.setItem('userPhone', p); 
                        localStorage.removeItem('pendingReferrer');
                        location.reload(); 
                    }); 
                }
            });
        };

        window.toggleAuth = (t) => { 
            document.getElementById('login-form').style.display = t==='signup'?'none':'block'; 
            document.getElementById('signup-form').style.display = t==='signup'?'block':'none'; 
            document.getElementById('auth-title').innerText = t==='signup'?'‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®':'‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®';
        };

        window.logoutAction = (f=false) => { 
            if(f || confirm("‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) { localStorage.clear(); location.reload(); } 
        };

        function renderUserInvestments() {
            const activeDiv = document.getElementById('my-investments');
            const expiredDiv = document.getElementById('expired-investments');
            if(!activeDiv || !expiredDiv) return;
            activeDiv.innerHTML = ""; expiredDiv.innerHTML = "";
            Object.values(claimTimers).forEach(clearInterval);
            claimTimers = {};
            if(userData && userData.investments) {
                Object.entries(userData.investments).reverse().forEach(([id, inv]) => {
                    if(inv.status === 'Active') {
                        const invCard = document.createElement('div');
                        invCard.className = 'invest-card';
                        const nextClaim = (inv.lastClaim || 0) + 86400000;
                        const canClaim = Date.now() >= nextClaim;
                        invCard.innerHTML = `<b>${inv.title}</b><br><small>‡¶Ü‡ßü: ‡ß≥${inv.daily} | ‡¶¶‡¶ø‡¶®: ${inv.daysCount}/${inv.totalDays}</small><div class="claim-bar"><div class="claim-progress" style="width:${(inv.daysCount/inv.totalDays)*100}%"></div></div><button id="btn-claim-${id}" class="btn-claim" ${canClaim ? '' : 'disabled'}>‡¶Æ‡ßÅ‡¶®‡¶æ‡¶´‡¶æ ‡¶®‡¶ø‡¶®</button>`;
                        activeDiv.appendChild(invCard);
                        const btn = document.getElementById(`btn-claim-${id}`);
                        if(!canClaim) {
                            claimTimers[id] = setInterval(() => {
                                const rem = nextClaim - Date.now();
                                if(rem <= 0) { clearInterval(claimTimers[id]); btn.innerText = "‡¶Æ‡ßÅ‡¶®‡¶æ‡¶´‡¶æ ‡¶®‡¶ø‡¶®"; btn.disabled = false; btn.onclick = () => window.claimProfit(id, inv.daily); } 
                                else { const h = Math.floor(rem/3600000).toString().padStart(2,'0'); const m = Math.floor((rem%3600000)/60000).toString().padStart(2,'0'); const s = Math.floor((rem%60000)/1000).toString().padStart(2,'0'); btn.innerText = `${h}:${m}:${s} ‡¶™‡¶∞`; }
                            }, 1000);
                        } else if(btn) btn.onclick = () => window.claimProfit(id, inv.daily);
                    } else if (inv.status === 'Expired') expiredDiv.innerHTML += `<div class="invest-card" style="border-left-color: #d32f2f; opacity: 0.8;"><b>${inv.title} (‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑)</b><br><small>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: ‡ß≥${inv.daily * inv.totalDays}</small></div>`;
                });
            }
        }

        function renderHistory(data) {
            const hist = document.getElementById('history-list');
            if(!hist) return;
            hist.innerHTML = "";
            if(data.deposits) Object.values(data.deposits).forEach(d => { if(d.phone === phone) hist.innerHTML += `<div class="invest-card" style="border-left-color: #5c6bc0;"><b>Topup: ‡ß≥${d.amount}</b> <span class="status-badge ${d.status.toLowerCase()}">${d.status}</span><br><small>${d.method} | ${d.time}</small></div>`; });
            if(data.withdrawals) Object.values(data.withdrawals).forEach(w => { if(w.phone === phone) hist.innerHTML += `<div class="invest-card" style="border-left-color: #c62828;"><b>Withdraw: ‡ß≥${w.amount}</b> <span class="status-badge ${w.status.toLowerCase()}">${w.status}</span><br><small>${w.method} | ${w.time}</small></div>`; });
        }

        function initAutoSlider(t) { if(slideInterval) clearInterval(slideInterval); if(t<=1) return; slideInterval = setInterval(() => { currentSlide = (currentSlide+1)%t; const w = document.getElementById('banner-list'); const d = document.querySelectorAll('.dot'); if(w) w.scrollLeft = w.clientWidth * currentSlide; d.forEach((x,i) => x.classList.toggle('active', i===currentSlide)); }, 3000); }
        function startSystemTimer(s) { if(!s) return; const st = new Date(s).getTime(); setInterval(() => { const df = Date.now()-st; if(df<0) return; if(document.getElementById('d')) document.getElementById('d').innerText = Math.floor(df/86400000); if(document.getElementById('h')) document.getElementById('h').innerText = Math.floor((df%86400000)/3600000); if(document.getElementById('m')) document.getElementById('m').innerText = Math.floor((df%3600000)/60000); if(document.getElementById('s')) document.getElementById('s').innerText = Math.floor((df%60000)/1000); }, 1000); }
    </script>
</body>
</html>
